(function(){"use strict";var e={8476:function(e,t,o){var a=o(9242),r=o(3396);function n(e,t,o,a,n,l){const i=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(i)}var l={name:"App"},i=o(89);const s=(0,i.Z)(l,[["render",n]]);var d=s,u=o(2483);const c=(0,r._)("p",null,"子供の見守り",-1);function m(e,t,o,a,n,l){const i=(0,r.up)("MapboxMap"),s=(0,r.up)("PageEnd");return(0,r.wg)(),(0,r.iD)(r.HY,null,[c,(0,r.Wm)(i),(0,r.Wm)(s)],64)}var g=o(7139);const p=e=>((0,r.dD)("data-v-7872ad06"),e=e(),(0,r.Cn)(),e),h={key:0,class:"text-container"},f=p((()=>(0,r._)("p",null,"アカウント",-1))),v={key:1},w={class:"text-container"},k=p((()=>(0,r._)("p",null,"子供位置関連操作",-1))),b={key:0},C=p((()=>(0,r._)("div",{class:"text-commend"},"*3秒毎に最新位置を取得できます。",-1))),F={key:1},I={class:"text-container"},T={key:0},L={key:1},_={key:2,class:"text-commend-update"},y=p((()=>(0,r._)("div",{id:"map"},null,-1)));function S(e,t,o,a,n,l){return(0,r.wg)(),(0,r.iD)("main",null,[n.loginFlag?((0,r.wg)(),(0,r.iD)("div",v,[(0,r._)("div",w,[k,0===n.updatingFlag?((0,r.wg)(),(0,r.iD)("div",b,[(0,r._)("div",{class:"button",onClick:t[2]||(t[2]=(...e)=>l.getChildLocationAuto&&l.getChildLocationAuto(...e))},"自動更新"),C])):(0,r.kq)("",!0),0!==n.updatingFlag?((0,r.wg)(),(0,r.iD)("div",F,[(0,r._)("div",{class:"button_margin",onClick:t[3]||(t[3]=(...e)=>l.stopUpdateChildLocation&&l.stopUpdateChildLocation(...e))},"自動更新中止"),n.trackChildLocationFlag?((0,r.wg)(),(0,r.iD)("div",{key:0,class:"button_margin",onClick:t[4]||(t[4]=(...e)=>l.stopTrackChildLocation&&l.stopTrackChildLocation(...e))},"追跡中止")):((0,r.wg)(),(0,r.iD)("div",{key:1,class:"button_margin",onClick:t[5]||(t[5]=(...e)=>l.trackChildLocation&&l.trackChildLocation(...e))},"追跡再開"))])):(0,r.kq)("",!0)]),(0,r._)("div",I,[0===n.distanceMeter?((0,r.wg)(),(0,r.iD)("div",T,"お子様が隣にいます。")):((0,r.wg)(),(0,r.iD)("div",L,"お子様との距離："+(0,g.zw)(n.distanceMeter),1)),0!==n.updateTime?((0,r.wg)(),(0,r.iD)("div",_,"*"+(0,g.zw)(n.updateTime)+"で取得した位置情報です。",1)):(0,r.kq)("",!0)])])):((0,r.wg)(),(0,r.iD)("div",h,[f,(0,r._)("div",null,[(0,r._)("div",{class:"button_margin",onClick:t[0]||(t[0]=(...e)=>l.TransitToRegistration&&l.TransitToRegistration(...e))},"登録"),(0,r._)("div",{class:"button_margin",onClick:t[1]||(t[1]=(...e)=>l.TransitToLogin&&l.TransitToLogin(...e))},"ログイン")])])),y])}o(7658);var W=o(7709),U=o.n(W),D=o(4018),x=o.n(D),M=o(4161),V=M.Z.create({baseURL:"https://192.168.11.16/",headers:{"Content-type":"application/json","Access-Control-Allow-Origin":"https://www.mimamaori.tech","Access-Control-Allow-Methods":"POST, PUT, PATCH, GET, DELETE, OPTIONS","Access-Control-Allow-Headers":"*",Authorization:"Bearer "+localStorage.getItem("token")===null?0:localStorage.getItem("token")}});class A{getAll(){return V.get("/location")}findByUserId(e){return V.get(`/location?userId=${e}&lastFlag=1`)}sendWebSocket(e){return V.get(`/webSocket/${e}`)}verifyToken(e){return V.get(`/verify/${e}`)}userRegister(e){return V.post("/api/register",e,{headers:{"Content-Type":"application/json;charset=utf-8"}})}userLogin(e){return V.post("/api/login",e,{headers:{"Content-Type":"application/json;charset=utf-8"}})}}var O=new A;const P=null!==localStorage.getItem("loginFlag")&&localStorage.getItem("loginFlag"),N=null===localStorage.getItem("token")?"":localStorage.getItem("token"),z=null===localStorage.getItem("userId")?"":localStorage.getItem("userId");var $={LoginFlag:P,token:N,userId:z};const j=$;var E,Z,G=j;U().supported()?console.log("Your browser supported Mapbox GL"):alert("Your browser does not support Mapbox GL");var H={name:"MapboxMap",data(){return{center:[139.7575,35.6789],location:[139.7575,35.6789],zoom:15,nowChildLat:0,nowChildLon:0,distanceMeter:0,updatingFlag:0,updateTime:0,trackChildLocationFlag:!1,loginFlag:!1}},mounted(){this.init(),this.createMap(),this.addCurrentLocation(),this.addNavigationControl()},methods:{init(){null===localStorage.getItem("loginFlag")||"false"===localStorage.getItem("loginFlag")?this.loginFlag=!1:this.loginFlag=!0;const e=null===localStorage.getItem("token")?"":localStorage.getItem("token");G.userId=null===localStorage.getItem("userId")?"":localStorage.getItem("userId"),G.LoginFlag=this.loginFlag,G.token=e,console.log("userId:"+G.userId+" loginflag:"+this.loginFlag+" token:"+G.token)},verifyToken(e){O.verifyToken(e).then((e=>{var t=e.data;"NG"===t&&this.verifyFailed()})).catch((e=>{this.verifyFailed(),console.log(e)}))},verifyFailed(){this.loginFlag=!1,localStorage.setItem("loginFlag",!1),localStorage.setItem("token",""),localStorage.setItem("userId",""),this.Toast("再ログインしてください。")},createMap(){this.map=new(U().Map)({accessToken:"pk.eyJ1IjoibWFwYm94bGl6aGlxdWFuIiwiYSI6ImNsZWZkejFyZzA0cTIzeHQxMTYzd2hrcjIifQ.GB7FcwHXN4gjp98WboK-1g",container:"map",style:"mapbox://styles/mapbox/streets-v11",minzoom:5,center:this.center,zoom:this.zoom,hash:!0}),this.map.addControl(new(x())({defaultLanguage:"ja"})),this.map.on("move",(()=>{this.center=this.map.getCenter()})),this.map.on("zoom",(()=>{this.zoom=this.map.getZoom()})),this.map.on("load",(()=>{}))},Toast(e,t){t=isNaN(t)?3e3:t;var o=document.createElement("div");o.innerHTML=e,o.style.cssText="font-size: .64rem;color: rgb(255, 0, 0);background-color: rgba(255, 255, 0, 0.6);padding: 10px 15px;margin: 0 0 0 -60px;border-radius: 4px;position: fixed; border: 2px solid rgb(255,194,64);   top: 50%;left: 50%;width: 130px;text-align: center;",document.body.appendChild(o),setTimeout((function(){var e=.5;o.style.opacity="0",setTimeout((function(){document.body.removeChild(o)}),1e3*e)}),t)},TransitToRegistration(){this.$router.push({name:"register"})},TransitToLogin(){this.$router.push({name:"login"})},addCurrentLocation(){let e=new(U().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},showAccuracyCircle:!0,showUserHeading:!0,showUserLocation:!0,trackUserLocation:!0});this.map.addControl(e),this.map.on("load",(()=>{e.trigger()})),e.on("geolocate",(e=>{const t=e.coords;this.location=[t.longitude,t.latitude],this.getLocationFromDB(),console.log("Your current position is:"),console.log(`Latitude : ${t.latitude}`),console.log(`Longitude: ${t.longitude}`),console.log(`More or less ${t.accuracy} meters.`)}))},addNavigationControl(){let e=new(U().NavigationControl)({visuaiizePitch:!0});this.map.addControl(e,"top-right")},addMarker(e,t){E=new(U().Marker)({color:"#FF7F50"}).setLngLat([e,t]).addTo(this.map),console.log("マーカー追加された"),this.trackChildLocationFlag&&this.moveToCenter(e,t),this.getDistance(e,t)},getChildLocationAuto(){this.startUpdateOnAndroid(),Z=setInterval(this.getLocationFromDB,3e3),this.updatingFlag=1,this.trackChildLocationFlag=!0},stopUpdateChildLocation(){this.stopUpdateOnAndroid(),clearInterval(Z),this.updatingFlag=0,this.trackChildLocationFlag=!1},moveToCenter(e,t){this.map.flyTo({center:[e,t],zoom:this.zoom})},getDistance(e,t){const o=new(U().LngLat)(e,t),a=new(U().LngLat)(this.location[0],this.location[1]);this.distanceMeter=this.formatDistance(a.distanceTo(o))},stopTrackChildLocation(){this.trackChildLocationFlag=!1},trackChildLocation(){this.trackChildLocationFlag=!0},formatDistance(e){if(e=Math.trunc(e),0===e)return 0;if(e/1e3<=0)return e+"m";{const t=Math.floor(e/1e3),o=e-1e3*t,a=0===t?0:t+"Km ",r=0===o?0:o+"m";return 0===a&&0===r?0:(0===t?"":t+"Km ")+(0===o?"":o+"m")}},startUpdateOnAndroid(){O.sendWebSocket("update").then((e=>{const t=e.data;"failed"===t&&this.Toast("アプリ側は通信できない状態なので、操作は失敗しました。",3e3),console.log(t)}))},stopUpdateOnAndroid(){O.sendWebSocket("stop_update").then((e=>{const t=e.data;"failed"===t&&this.Toast("アプリ側は通信できない状態なので、操作は失敗しました。",3e3),console.log(t)}))},getLocationFromDB(){!1!==this.loginFlag&&O.findByUserId(G.userId).then((e=>{var t=e.data;if(!(t.size<=0)){var o=t[0];o.latitude&&o.longitude&&(this.nowChildLat===location.Latitude&&this.nowChildLon===location.longitude||(E&&E.remove(),this.nowChildLon=o.longitude,this.nowChildLat=o.latitude,this.updateTime=o.updateTime,this.addMarker(this.nowChildLon,this.nowChildLat)))}})).catch((e=>{console.log(e)}))}}};const R=(0,i.Z)(H,[["render",S],["__scopeId","data-v-7872ad06"]]);var q=R;const Y=e=>((0,r.dD)("data-v-50963686"),e=e(),(0,r.Cn)(),e),B={class:"pagen-end"},K=Y((()=>(0,r._)("a",{href:"https://beian.miit.gov.cn",target:"_blank"},"鲁ICP备2023035299号-1",-1))),J=[K];function Q(e,t,o,a,n,l){return(0,r.wg)(),(0,r.iD)("main",B,J)}var X={name:"PageEnd",data(){return{}},mounted(){}};const ee=(0,i.Z)(X,[["render",Q],["__scopeId","data-v-50963686"]]);var te=ee,oe={name:"TopPage",components:{MapboxMap:q,PageEnd:te}};const ae=(0,i.Z)(oe,[["render",m]]);var re=ae;const ne=e=>((0,r.dD)("data-v-ce25047a"),e=e(),(0,r.Cn)(),e),le=ne((()=>(0,r._)("h2",{class:"title-zc"},"アカウント登録",-1))),ie={class:"register-container"};function se(e,t,o,n,l,i){const s=(0,r.up)("el-input"),d=(0,r.up)("el-form-item"),u=(0,r.up)("el-option"),c=(0,r.up)("el-select"),m=(0,r.up)("el-button"),g=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)(r.HY,null,[le,(0,r._)("div",ie,[(0,r.Wm)(g,{ref:"form",model:l.form,"status-icon":"",rules:l.rules,"label-width":"auto","label-position":"left",class:"register-form"},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"アカウント名",prop:"userId"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{modelValue:l.form.userId,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form.userId=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"パスワード",prop:"passWord"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{type:"password",modelValue:l.form.passWord,"onUpdate:modelValue":t[1]||(t[1]=e=>l.form.passWord=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"パスワード(確認用)",prop:"checkPass"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{type:"password",modelValue:l.form.checkPass,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.checkPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"ニックネーム",prop:"userName"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{modelValue:l.form.userName,"onUpdate:modelValue":t[3]||(t[3]=e=>l.form.userName=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"メールアドレス",prop:"mailAddress"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{modelValue:l.form.mailAddress,"onUpdate:modelValue":t[4]||(t[4]=e=>l.form.mailAddress=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"学級",prop:"childGrade"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{modelValue:l.form.childGrade,"onUpdate:modelValue":t[5]||(t[5]=e=>l.form.childGrade=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"続柄",prop:"relationShipCode"},{default:(0,r.w5)((()=>[(0,r.Wm)(c,{modelValue:l.form.relationShipCode,"onUpdate:modelValue":t[6]||(t[6]=e=>l.form.relationShipCode=e),remote:"",filterable:"",onChange:i.selectChange},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(l.relationShipList,((e,t)=>(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{key:e.value+`'${t}'`,label:e.label,value:e.value},null,8,["label","value"])),[[a.F8,!1!==e.isShow]]))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Wm)(m,{type:"primary",class:"button",onClick:t[7]||(t[7]=e=>i.submitForm("form"))},{default:(0,r.w5)((()=>[(0,r.Uk)("登録")])),_:1}),(0,r.Wm)(m,{class:"button",onClick:t[8]||(t[8]=e=>i.resetForm("form"))},{default:(0,r.w5)((()=>[(0,r.Uk)("クリア")])),_:1}),(0,r.Wm)(m,{class:"button",onClick:i.TransitToTop},{default:(0,r.w5)((()=>[(0,r.Uk)("戻る")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])],64)}var de=o(4870),ue={name:"MyRegistration",data(){var e=(e,t,o)=>{""===t?o(new Error("パスワードを入力してください。")):(""!==this.form.checkPass&&this.$refs.form.validateField("checkPass"),o())},t=(e,t,o)=>{""===t?o(new Error("パスワードを入力してください。")):t!==this.form.passWord?o(new Error("パスワードが一致しません。")):o()};return{relationShipList:(0,de.iH)([{isShow:!0,value:1,label:"父"},{isShow:!0,value:2,label:"母"},{isShow:!0,value:3,label:"子"}]),form:{userId:"",userName:"",passWord:"",checkPass:"",mailAddress:"",childGrade:"",relationShipCode:"未選択",relationShipName:""},rules:{userId:[{required:!0,message:"アカウントを入力してください。",trigger:"blur"}],userName:[{required:!0,message:"ニックネームを入力してください。",trigger:"blur"}],passWord:[{required:!0,validator:e,trigger:"blur"}],checkPass:[{required:!0,validator:t,trigger:"blur"}],mailAddress:[{type:"email",message:"正しいメールアドレス入力してください。",trigger:"change"}],relationShipCode:[{required:!0,message:"続柄を入力してください。",trigger:"blur"}]}}},mounted(){},methods:{submitForm(e){this.$refs[e].validate((e=>{if(!e)return console.log("登録失敗!!"),!1;O.userRegister(JSON.stringify(this.form)).then((e=>{"OK"===e.data?(this.resetForm("form"),alert("登録成功。自動的にログイン画面に遷移する"),this.$router.push({name:"login"})):"EXIST"===e.data?alert("登録失敗。アカウント名は既に存在しています。"):alert("登録失敗しました。サーバー側問題があります。")})).catch((function(e){console.log(e),alert("登録失敗しました。サーバー側問題があります。")}))}))},resetForm(e){this.$refs[e].resetFields()},TransitToTop(){this.$router.push({name:"top"})},selectChange(){console.log(this.form.relationShipCode),this.form.relationShipName=this.relationShipList[this.form.relationShipCode-1].label}}};const ce=(0,i.Z)(ue,[["render",se],["__scopeId","data-v-ce25047a"]]);var me=ce;const ge=e=>((0,r.dD)("data-v-a8190084"),e=e(),(0,r.Cn)(),e),pe=ge((()=>(0,r._)("h2",{class:"title-zc"},"ログイン画面",-1))),he={class:"login-container"};function fe(e,t,o,a,n,l){const i=(0,r.up)("el-input"),s=(0,r.up)("el-form-item"),d=(0,r.up)("el-button"),u=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)(r.HY,null,[pe,(0,r._)("div",he,[(0,r.Wm)(u,{ref:"loginForm",model:n.loginForm,"status-icon":"",rules:n.rules,"label-width":"auto","label-position":"left",class:"login-form"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{label:"アカウント名",prop:"userId"},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{modelValue:n.loginForm.userId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.loginForm.userId=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(s,{label:"パスワード",prop:"passWord"},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{type:"password",modelValue:n.loginForm.passWord,"onUpdate:modelValue":t[1]||(t[1]=e=>n.loginForm.passWord=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(s,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{type:"primary",class:"button",onClick:t[2]||(t[2]=e=>l.submitForm("loginForm"))},{default:(0,r.w5)((()=>[(0,r.Uk)("ログイン")])),_:1}),(0,r.Wm)(d,{class:"button",onClick:t[3]||(t[3]=e=>l.resetForm("loginForm"))},{default:(0,r.w5)((()=>[(0,r.Uk)("クリア")])),_:1}),(0,r.Wm)(d,{class:"button",onClick:l.TransitToTop},{default:(0,r.w5)((()=>[(0,r.Uk)("トップに戻る")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])],64)}var ve={name:"LoginTo",data(){return{loginForm:{userId:"",passWord:""},rules:{userId:[{required:!0,message:"アカウントを入力してください。",trigger:"blur"}],passWord:[{required:!0,message:"パスワードを入力してください。",trigger:"blur"}]}}},mounted(){},methods:{submitForm(e){this.$refs[e].validate((e=>{if(!e)return console.log("登録失敗!!"),!1;O.userLogin(JSON.stringify(this.loginForm)).then((e=>{var t=e.data;if("NO_USER"===t)alert("先にアカウント登録してください。");else if("PASS_ERROR"===t)alert("アカウント名とパスワードが間違っています。");else if(t.startsWith("UserId")){var o=t.split(":");o.length>2?(G.userId=o[1],G.LoginFlag=!0,G.token=o[2],localStorage.setItem("loginFlag",!0),localStorage.setItem("userId",o[1]),localStorage.setItem("token",o[2]),console.log("token is :"+G.token),console.log("userId is :"+G.userId),this.resetForm("loginForm"),alert("ログイン成功。自動的にトップ画面に遷移する"),this.$router.push({name:"top"})):alert("ログイン失敗しました。サーバー側ユーザーID取得には問題があります。")}else alert("ログイン失敗しました。サーバー側未知問題があります。")})).catch((function(e){console.log(e),alert("登録失敗しました。サーバー側問題があります。")}))}))},resetForm(e){this.$refs[e].resetFields()},TransitToTop(){this.$router.push({name:"top"})}}};const we=(0,i.Z)(ve,[["render",fe],["__scopeId","data-v-a8190084"]]);var ke=we;function be(e,t,o,a,n,l){return(0,r.wg)(),(0,r.iD)("div",null,"404")}var Ce={name:"NotFound"};const Fe=(0,i.Z)(Ce,[["render",be]]);var Ie=Fe;const Te=[{path:"/",name:"top",component:re},{path:"/registration",name:"register",component:me},{path:"/loginPage",name:"login",component:ke},{path:"/doLogin/:userId/:password",name:"doLogin",component:ke,props:e=>({userId:e.params.userId,password:e.params.password})},{path:"/error",component:Ie}],Le=(0,u.p7)({history:(0,u.PO)("/"),routes:Te});var _e=Le,ye=o(6593);o(4415);(0,a.ri)(d).use(_e).use(ye.Z).mount("#app")}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,a,r,n){if(!a){var l=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],n=e[u][2];for(var i=!0,s=0;s<a.length;s++)(!1&n||l>=n)&&Object.keys(o.O).every((function(e){return o.O[e](a[s])}))?a.splice(s--,1):(i=!1,n<l&&(l=n));if(i){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[a,r,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,n,l=a[0],i=a[1],s=a[2],d=0;if(l.some((function(t){return 0!==e[t]}))){for(r in i)o.o(i,r)&&(o.m[r]=i[r]);if(s)var u=s(o)}for(t&&t(a);d<l.length;d++)n=l[d],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(u)},a=self["webpackChunkfamiliar_server"]=self["webpackChunkfamiliar_server"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[998],(function(){return o(8476)}));a=o.O(a)})();
//# sourceMappingURL=app.61991885.js.map