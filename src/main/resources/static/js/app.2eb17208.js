(function(){"use strict";var t={9826:function(t,o,e){var n=e(9242),i=e(3396);const a=(0,i._)("p",null,"子供の見守り",-1);function r(t,o,e,n,r,s){const c=(0,i.up)("MapboxMap"),d=(0,i.up)("PageEnd");return(0,i.wg)(),(0,i.iD)(i.HY,null,[a,(0,i.Wm)(c),(0,i.Wm)(d)],64)}var s=e(7139);const c=t=>((0,i.dD)("data-v-0580e6f6"),t=t(),(0,i.Cn)(),t),d={class:"text-container"},l=c((()=>(0,i._)("p",null,"子供位置関連操作",-1))),u={key:0},h=c((()=>(0,i._)("div",{class:"text-commend"},"*3秒毎に最新位置を取得できます。",-1))),p={key:1},g={class:"text-container"},m={key:0},f={key:1},v={key:2,class:"text-commend-update"},C=c((()=>(0,i._)("div",{id:"map"},null,-1)));function w(t,o,e,n,a,r){return(0,i.wg)(),(0,i.iD)("main",null,[(0,i._)("div",d,[l,0===a.updatingFlag?((0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("div",{class:"button",onClick:o[0]||(o[0]=(...t)=>r.getChildLocationAuto&&r.getChildLocationAuto(...t))},"自動更新"),h])):(0,i.kq)("",!0),0!==a.updatingFlag?((0,i.wg)(),(0,i.iD)("div",p,[(0,i._)("div",{class:"button_margin",onClick:o[1]||(o[1]=(...t)=>r.stopUpdateChildLocation&&r.stopUpdateChildLocation(...t))},"自動更新中止"),a.trackChildLocationFlag?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"button_margin",onClick:o[2]||(o[2]=(...t)=>r.stopTrackChildLocation&&r.stopTrackChildLocation(...t))},"追跡中止")):((0,i.wg)(),(0,i.iD)("div",{key:1,class:"button_margin",onClick:o[3]||(o[3]=(...t)=>r.trackChildLocation&&r.trackChildLocation(...t))},"追跡再開"))])):(0,i.kq)("",!0)]),(0,i._)("div",g,[0===a.distanceMeter?((0,i.wg)(),(0,i.iD)("div",m,"お子様が隣にいます。")):((0,i.wg)(),(0,i.iD)("div",f,"お子様との距離："+(0,s.zw)(a.distanceMeter),1)),0!==a.updateTime?((0,i.wg)(),(0,i.iD)("div",v,"*"+(0,s.zw)(a.updateTime)+"で取得した位置情報です。",1)):(0,i.kq)("",!0)]),C])}var L=e(7709),b=e.n(L),k=e(4018),y=e.n(k),T=e(4161),x=T.Z.create({baseURL:"https://www.mimamaori.tech/",headers:{"Content-type":"application/json","Access-Control-Allow-Origin":"https://www.mimamaori.tech","Access-Control-Allow-Methods":"POST, PUT, PATCH, GET, DELETE, OPTIONS","Access-Control-Allow-Headers":"*"}});class M{getAll(){return x.get("/location")}findByUserId(t){return x.get(`/location?userId=${t}&lastFlag=1`)}sendWebSocket(t){return x.get(`/webSocket/${t}`)}}var F,_,D=new M;b().supported()?console.log("Your browser supported Mapbox GL"):alert("Your browser does not support Mapbox GL");var O={name:"MapboxMap",data(){return{center:[139.7575,35.6789],location:[139.7575,35.6789],zoom:15,nowChildLat:0,nowChildLon:0,distanceMeter:0,updatingFlag:0,updateTime:0,trackChildLocationFlag:!1}},mounted(){this.createMap(),this.addCurrentLocation(),this.addNavigationControl()},methods:{createMap(){this.map=new(b().Map)({accessToken:"pk.eyJ1IjoibWFwYm94bGl6aGlxdWFuIiwiYSI6ImNsZWZkejFyZzA0cTIzeHQxMTYzd2hrcjIifQ.GB7FcwHXN4gjp98WboK-1g",container:"map",style:"mapbox://styles/mapbox/streets-v11",minzoom:5,center:this.center,zoom:this.zoom,hash:!0}),this.map.addControl(new(y())({defaultLanguage:"ja"})),this.map.on("move",(()=>{this.center=this.map.getCenter()})),this.map.on("zoom",(()=>{this.zoom=this.map.getZoom()})),this.map.on("load",(()=>{}))},Toast(t,o){o=isNaN(o)?3e3:o;var e=document.createElement("div");e.innerHTML=t,e.style.cssText="font-size: .64rem;color: rgb(255, 0, 0);background-color: rgba(255, 255, 0, 0.6);padding: 10px 15px;margin: 0 0 0 -60px;border-radius: 4px;position: fixed; border: 2px solid rgb(255,194,64);   top: 50%;left: 50%;width: 130px;text-align: center;",document.body.appendChild(e),setTimeout((function(){var t=.5;e.style.opacity="0",setTimeout((function(){document.body.removeChild(e)}),1e3*t)}),o)},addCurrentLocation(){let t=new(b().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},showAccuracyCircle:!0,showUserHeading:!0,showUserLocation:!0,trackUserLocation:!0});this.map.addControl(t),this.map.on("load",(()=>{t.trigger()})),t.on("geolocate",(t=>{const o=t.coords;this.location=[o.longitude,o.latitude],this.getLocationFromDB(),console.log("Your current position is:"),console.log(`Latitude : ${o.latitude}`),console.log(`Longitude: ${o.longitude}`),console.log(`More or less ${o.accuracy} meters.`)}))},addNavigationControl(){let t=new(b().NavigationControl)({visuaiizePitch:!0});this.map.addControl(t,"top-right")},addMarker(t,o){F=new(b().Marker)({color:"#FF7F50"}).setLngLat([t,o]).addTo(this.map),console.log("マーカー追加された"),this.trackChildLocationFlag&&this.moveToCenter(t,o),this.getDistance(t,o)},getChildLocationAuto(){this.startUpdateOnAndroid(),_=setInterval(this.getLocationFromDB,3e3),this.updatingFlag=1,this.trackChildLocationFlag=!0},stopUpdateChildLocation(){this.stopUpdateOnAndroid(),clearInterval(_),this.updatingFlag=0,this.trackChildLocationFlag=!1},moveToCenter(t,o){this.map.flyTo({center:[t,o],zoom:this.zoom})},getDistance(t,o){const e=new(b().LngLat)(t,o),n=new(b().LngLat)(this.location[0],this.location[1]);this.distanceMeter=this.formatDistance(n.distanceTo(e))},stopTrackChildLocation(){this.trackChildLocationFlag=!1},trackChildLocation(){this.trackChildLocationFlag=!0},formatDistance(t){if(t=Math.trunc(t),0===t)return 0;if(t/1e3<=0)return t+"m";{const o=Math.floor(t/1e3),e=t-1e3*o,n=0===o?0:o+"Km ",i=0===e?0:e+"m";return 0===n&&0===i?0:(0===o?"":o+"Km ")+(0===e?"":e+"m")}},startUpdateOnAndroid(){D.sendWebSocket("update").then((t=>{const o=t.data;"failed"===o&&this.Toast("アプリ側は通信できない状態なので、操作は失敗しました。",3e3),console.log(o)}))},stopUpdateOnAndroid(){D.sendWebSocket("stop_update").then((t=>{const o=t.data;"failed"===o&&this.Toast("アプリ側は通信できない状態なので、操作は失敗しました。",3e3),console.log(o)}))},getLocationFromDB(){D.findByUserId("1001").then((t=>{var o=t.data;if(!(o.size<=0)){var e=o[0];this.nowChildLat===location.Latitude&&this.nowChildLon===location.longitude||(F&&F.remove(),this.nowChildLon=e.longitude,this.nowChildLat=e.latitude,this.updateTime=e.updateTime,this.addMarker(this.nowChildLon,this.nowChildLat))}})).catch((t=>{console.log(t)}))}}},A=e(89);const z=(0,A.Z)(O,[["render",w],["__scopeId","data-v-0580e6f6"]]);var I=z;const U=t=>((0,i.dD)("data-v-50963686"),t=t(),(0,i.Cn)(),t),j={class:"pagen-end"},P=U((()=>(0,i._)("a",{href:"https://beian.miit.gov.cn",target:"_blank"},"鲁ICP备2023035299号-1",-1))),E=[P];function W(t,o,e,n,a,r){return(0,i.wg)(),(0,i.iD)("main",j,E)}var H={name:"PageEnd",data(){return{}},mounted(){}};const N=(0,A.Z)(H,[["render",W],["__scopeId","data-v-50963686"]]);var Z=N,G={name:"App",components:{MapboxMap:I,PageEnd:Z}};const S=(0,A.Z)(G,[["render",r]]);var Y=S;(0,n.ri)(Y).mount("#app")}},o={};function e(n){var i=o[n];if(void 0!==i)return i.exports;var a=o[n]={exports:{}};return t[n].call(a.exports,a,a.exports,e),a.exports}e.m=t,function(){var t=[];e.O=function(o,n,i,a){if(!n){var r=1/0;for(l=0;l<t.length;l++){n=t[l][0],i=t[l][1],a=t[l][2];for(var s=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(e.O).every((function(t){return e.O[t](n[c])}))?n.splice(c--,1):(s=!1,a<r&&(r=a));if(s){t.splice(l--,1);var d=i();void 0!==d&&(o=d)}}return o}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[n,i,a]}}(),function(){e.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(o,{a:o}),o}}(),function(){e.d=function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)}}(),function(){var t={143:0};e.O.j=function(o){return 0===t[o]};var o=function(o,n){var i,a,r=n[0],s=n[1],c=n[2],d=0;if(r.some((function(o){return 0!==t[o]}))){for(i in s)e.o(s,i)&&(e.m[i]=s[i]);if(c)var l=c(e)}for(o&&o(n);d<r.length;d++)a=r[d],e.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return e.O(l)},n=self["webpackChunkfamiliar_server"]=self["webpackChunkfamiliar_server"]||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))}();var n=e.O(void 0,[998],(function(){return e(9826)}));n=e.O(n)})();
//# sourceMappingURL=app.2eb17208.js.map